<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="ansible," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="ansible安装服务器信息配置
ansible配置文件 - ansible.cfg 

定义各种通用变量
查找ansible.cfg文件的顺序
ANSIBLE_CONFIG环境变量所指定的文件
./ansible.cfg
~/.ansible.cfg
/etc/ansible/ansible.cfg


配置举例：
1inventory = /etc/ansible/hosts  #指定inve">
<meta property="og:type" content="article">
<meta property="og:title" content="ansible_learn_note">
<meta property="og:url" content="http://yoursite.com/2016/12/28/ansible-learn-note/index.html">
<meta property="og:site_name" content="Lanourain's blog">
<meta property="og:description" content="ansible安装服务器信息配置
ansible配置文件 - ansible.cfg 

定义各种通用变量
查找ansible.cfg文件的顺序
ANSIBLE_CONFIG环境变量所指定的文件
./ansible.cfg
~/.ansible.cfg
/etc/ansible/ansible.cfg


配置举例：
1inventory = /etc/ansible/hosts  #指定inve">
<meta property="og:updated_time" content="2017-01-24T06:02:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ansible_learn_note">
<meta name="twitter:description" content="ansible安装服务器信息配置
ansible配置文件 - ansible.cfg 

定义各种通用变量
查找ansible.cfg文件的顺序
ANSIBLE_CONFIG环境变量所指定的文件
./ansible.cfg
~/.ansible.cfg
/etc/ansible/ansible.cfg


配置举例：
1inventory = /etc/ansible/hosts  #指定inve">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/12/28/ansible-learn-note/"/>





  <title> ansible_learn_note | Lanourain's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Lanourain's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">I fight, so you don't have to.</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/28/ansible-learn-note/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="lanourain">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Lanourain's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Lanourain's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                ansible_learn_note
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-28T18:14:33+08:00">
                2016-12-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ansible/" itemprop="url" rel="index">
                    <span itemprop="name">ansible</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="ansible安装"><a href="#ansible安装" class="headerlink" title="ansible安装"></a>ansible安装</h3><h3 id="服务器信息配置"><a href="#服务器信息配置" class="headerlink" title="服务器信息配置"></a>服务器信息配置</h3><ul>
<li><p>ansible配置文件 - <a href="http://docs.ansible.com/ansible/intro_configuration.html" target="_blank" rel="external">ansible.cfg</a> </p>
<ul>
<li>定义各种通用变量</li>
<li>查找ansible.cfg文件的顺序<ul>
<li>ANSIBLE_CONFIG环境变量所指定的文件</li>
<li>./ansible.cfg</li>
<li>~/.ansible.cfg</li>
<li>/etc/ansible/ansible.cfg</li>
</ul>
</li>
<li><p>配置举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">inventory = /etc/ansible/hosts  #指定inventory文件位置</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Ansible只能管理指定的服务器，在inventory文件中进行配置。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">hosts(文件目录，创建hosts作为inventory文件）</div><div class="line"></div><div class="line">--组名（对系统进行分类）</div><div class="line">[webservers]</div><div class="line">--主机名</div><div class="line">foo.example.com                             </div><div class="line">--指定系统的别名 + ssh的用户</div><div class="line">jumper ansible_ssh_host=192.168.1.50 ansible_ssh_user=appadmin        </div><div class="line">--01到50,一组相似的hostname</div><div class="line">www[01:50].example.com</div></pre></td></tr></table></figure>
<ul>
<li>服务器设置变量</li>
</ul>
<h3 id="指令相关"><a href="#指令相关" class="headerlink" title="指令相关"></a>指令相关</h3><h4 id="常用执行：ansible，-ansible-playbook（执行playbook）"><a href="#常用执行：ansible，-ansible-playbook（执行playbook）" class="headerlink" title="常用执行：ansible， ansible-playbook（执行playbook）"></a>常用执行：ansible， ansible-playbook（执行playbook）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">ansible-doc service #查看对应模块的文档</div><div class="line"></div><div class="line">-m, --module-name: module name to execute(default=command)</div><div class="line">-a, --args: module arguments</div><div class="line"></div><div class="line">-l, --limit=SUBSET: further limit selected hosts to an additional pattern,限定组或host来执行playbook</div><div class="line"></div><div class="line">all : all hosts in inventory</div><div class="line"></div><div class="line">-c, --connect: connect type to use (default=smart)</div><div class="line">-c paramiko</div><div class="line"></div><div class="line">-i, --inventory-file: specify inventory host path(default=/etc/ansible/hosts) or comma separated host list.</div><div class="line">-i test/hosts</div><div class="line"></div><div class="line">--ask-vault-pass: ask for vault password(sudo 模式需要)</div><div class="line"></div><div class="line">-b, --become: run operations with become (does not imply password prompting)(使用playbook制定的become_user进行操作)</div><div class="line"></div><div class="line">-t TAGS, --tags=TAGS  only run plays and tasks tagged with these values</div></pre></td></tr></table></figure>
<h3 id="playbook相关"><a href="#playbook相关" class="headerlink" title="playbook相关"></a>playbook相关</h3><h4 id="yaml解析"><a href="#yaml解析" class="headerlink" title="yaml解析"></a>yaml解析</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">- hosts: all    #执行tasks的主机，all表示所有</div><div class="line">  become: yes   #使用特定用户执行tasks，该参数也可以配置在相应task中。</div><div class="line">  become_user: root</div><div class="line">  remote_user: username #the user log into machine.</div><div class="line">  </div><div class="line">  tasks:</div><div class="line">    # 每个task都相当于在执行对应模块的功能</div><div class="line">    # 描述task</div><div class="line">    - name: Creates destination directory</div><div class="line">      # 执行对应模块功能</div><div class="line">      copy: src=~/.ssh/id_dsa.pub dest=/root/.ssh/authorized_keys owner=root mode=0600</div><div class="line">      # 设置相应变量（执行结果设置到该变量？？）</div><div class="line">      register: rsa</div><div class="line">      # 设置环境变量</div><div class="line">      environment:</div><div class="line">        JAVA_HOME: /usr/java/jre1.8.0_51</div><div class="line">      # 忽略错误</div><div class="line">      ignore_errors: yes</div><div class="line">      # These ‘notify’ actions are triggered at the end of each block of tasks in a play, and will only be triggered once even if notified by multiple different tasks.</div><div class="line">      notify: </div><div class="line">        - restart apache</div><div class="line">      # 给这部分task打上tags，可指定只执行相应tags的task  (命令中添加：-t deploy)</div><div class="line">      tags: deploy</div></pre></td></tr></table></figure>
<h4 id="notify使用"><a href="#notify使用" class="headerlink" title="notify使用"></a>notify使用</h4><ul>
<li>These ‘notify’ actions are triggered at the end of each block of tasks in a play, and will only be triggered once even if notified by multiple different tasks.</li>
<li>支持设置handlers，handlers是在执行tasks之后服务器发生变化之后可供调用的handler</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># playbook.yml</div><div class="line">---</div><div class="line">- hosts: local  # hosts中指定</div><div class="line">  remote_user: root  # 如果和当前用户一样，则无需指定</div><div class="line">  tasks:</div><div class="line">      - name: whoami</div><div class="line">        copy: src=~/hosts dest=~/hosts.dest  #  本地拷贝到远端</div><div class="line">        notify:  # 如果copy执行完之后~/hosts.dest文件发送了变化，则执行</div><div class="line">            - clear copy  # 调用handler</div><div class="line">  handlers:</div><div class="line">      - name: clear copy</div><div class="line">        shell: &apos;mv ~/hosts.dest hosts.del&apos;  # 假装删除</div></pre></td></tr></table></figure>
<h4 id="特性："><a href="#特性：" class="headerlink" title="特性："></a>特性：</h4><ul>
<li>the playbook will act only if there is something to do. It’s called idempotency, and means that you can run your playbook as many times as you want, you will always end up in the same state (well, unless you do crazy things with the shell module of course, but this is beyond ansible’s control).</li>
<li>当task报错时，会终止执行，后续的task都不会执行。</li>
<li>task报错前的操作不会回滚。</li>
</ul>
<h3 id="模块相关"><a href="#模块相关" class="headerlink" title="模块相关"></a>模块相关</h3><ul>
<li>file：包含了文件、文件夹、超级链接类的创立、拷贝、移动、删除操作。</li>
<li>copy：copy a file on the local box to remote locations.</li>
<li>fetch: copy files from remote locations to the local box.</li>
<li>template - Templates a file out to a remote server.</li>
<li>command: Executes a command on a remote node(It will not be processed through the shell, so variables like $HOME and operations like “&lt;”, “&gt;”, “|”, “;” and “&amp;” will not work)</li>
<li>lineinfile - Ensure a particular line is in a file, or replace an existing line using a back-referenced regular expression.</li>
<li>pause - Pause playbook execution</li>
<li>ping - Try to connect to host, verify a usable python and return pong on success.</li>
<li>shell - Execute commands in nodes.(runs the command through a shell (/bin/sh) on the remote node.)</li>
<li>debug - Print statements during execution</li>
<li>setup - Gathers facts about remote hosts（默认执行）,支持filter。</li>
<li>apt - Manages apt-packages</li>
<li>service：Controls services on remote hosts</li>
<li>fail - Fail with custom message</li>
<li>subversion - Deploys a subversion repository.</li>
<li>group - Add or remove groups</li>
<li>user - Manage user accounts</li>
<li>get_url - Downloads files from HTTP, HTTPS, or FTP to node</li>
<li>subversion - Deploy given repository URL / revision to dest.</li>
<li>wait_for - Waits for a condition before continuing.</li>
</ul>
<h3 id="变量相关"><a href="#变量相关" class="headerlink" title="变量相关"></a>变量相关</h3><p>ansible支持变量定义和变量替换。</p>
<h4 id="在文件中定义变量"><a href="#在文件中定义变量" class="headerlink" title="在文件中定义变量"></a>在文件中定义变量</h4><ul>
<li><p>文件中为host group定义公用的变量</p>
<ul>
<li><p>hosts中的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[web]</div><div class="line">host1.example.org ansible_host=192.168.33.11 ansible_user=root</div><div class="line">host2.example.org ansible_host=192.168.33.12 ansible_user=root</div><div class="line"></div><div class="line">[haproxy]</div><div class="line">host0.example.org ansible_host=192.168.33.10 ansible_user=root</div></pre></td></tr></table></figure>
</li>
<li><p>新增 group_vars/haproxy 文件，如下配置对于属于 haproxy组的主机都会生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">haproxy_check_interval: 3000</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>在文件中定义host的变量</p>
<ul>
<li>hosts的配置如上。</li>
<li>新增如下文件：<ul>
<li>host_vars/host0.example.org</li>
<li>host_vars/host1.example.org</li>
<li>host_vars/host2.example.org</li>
</ul>
</li>
<li><p>每个文件都增加如下配置，如下配置都会应用于对应主机：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">haproxy_backend_weight: 150 haproxy_stats_socket: /tmp/sock</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="在playbook中定义变量"><a href="#在playbook中定义变量" class="headerlink" title="在playbook中定义变量"></a>在playbook中定义变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vars:</div><div class="line">  key_var: test_key</div></pre></td></tr></table></figure>
<ul>
<li>支持把变量定义放在文件中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vars_files:</div><div class="line">  - vars.yml</div><div class="line"></div><div class="line">vars.yml中：</div><div class="line">key_var: test_key</div></pre></td></tr></table></figure>
<ul>
<li>使用item变量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- name: Installs necessary packages</div><div class="line">  apt: pkg=&#123;&#123; item &#125;&#125; state=latest </div><div class="line">  with_items:</div><div class="line">    - apache2</div><div class="line">    - libapache2-mod-php5</div><div class="line">    - git</div></pre></td></tr></table></figure>
<ul>
<li><p>注册变量：</p>
<ul>
<li><p>register：Another major use of variables is running a command and using the result of that command to save the result into a variable. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- hosts: web_servers</div><div class="line">  tasks:</div><div class="line">     - shell: /usr/bin/foo</div><div class="line">       register: foo_result</div><div class="line">       ignore_errors: True</div><div class="line"></div><div class="line">     - shell: /usr/bin/bar</div><div class="line">       when: foo_result.rc == 5</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>访问变量中字典的key</p>
<ul>
<li>如果变量中包含字典，可通过.来访问key</li>
<li><figure class="highlight plain"><figcaption><span>login.stdout &#125;&#125;```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">    </div><div class="line">#### 内置通用变量</div><div class="line">* ignore_errors：忽略模块返回的错误，继续执行剩余task</div><div class="line">* when: 相应条件下跳过task的执行</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>tasks:</p>
<ul>
<li><p>command: /bin/false<br>register: result<br>ignore_errors: True</p>
</li>
<li><p>command: /bin/something<br>when: result|failed</p>
<h1 id="In-older-versions-of-ansible-use-success-now-both-are-valid-but-succeeded-uses-the-correct-tense"><a href="#In-older-versions-of-ansible-use-success-now-both-are-valid-but-succeeded-uses-the-correct-tense" class="headerlink" title="In older versions of ansible use |success, now both are valid but succeeded uses the correct tense."></a>In older versions of ansible use |success, now both are valid but succeeded uses the correct tense.</h1></li>
<li><p>command: /bin/something_else<br>when: result|succeeded</p>
</li>
<li><p>command: /bin/still/something_else<br>when: result|skipped</p>
</li>
<li><p>name: “shut down Debian flavored systems”<br>command: /sbin/shutdown -t now<br>when: ansible_os_family == “Debian”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">* fact：执行setup后，采集到的主机的各种详细信息。内涵字典，可通过字典中的key访问value。```ansible_facts.ansible_distribution, ansible_facts.ansible_all_ipv4_addresses ```等。</div><div class="line">* hostvars：All hosts&apos; facts</div><div class="line"></div><div class="line">### Templates</div><div class="line">Ansible uses [Jinja2](http://jinja.pocoo.org/docs/), a templating engine for Python. When you write Jinja2 templates, you can use any variable defined by Ansible.</div><div class="line"></div><div class="line">For instance, if you want to output the inventory_name of the host the template is currently built for, you just can write &#123;&#123; inventory_hostname &#125;&#125; in the Jinja template.</div><div class="line"></div><div class="line">Or if you need the IP of the first ethernet interface (which ansible knows thanks to the setup module), you just write: &#123;&#123; ansible_eth1[&apos;ipv4&apos;][&apos;address&apos;] &#125;&#125; in your template.</div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="template-example，a-config"><a href="#template-example，a-config" class="headerlink" title="template example，a config"></a>template example，a config</h1><p>global<br>    daemon<br>    maxconn 256</p>
<p>defaults<br>    mode http<br>    timeout connect 5000ms<br>    timeout client 50000ms<br>    timeout server 50000ms</p>
<p>listen cluster<br>    bind :80   ## will be replaced by the IP of the load balancer on eth1.<br>    mode http<br>    stats enable<br>    balance roundrobin<br><br>    option httpchk HEAD /index.php HTTP/1.0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### Role的使用</div><div class="line">* 将playbook分割为多个文件的主要机制，易于复用。</div><div class="line">* 参考：https://github.com/leucos/ansible-tuto/tree/master/step-12</div><div class="line"></div><div class="line">### 问题</div><div class="line">* 执行ansible all -i hosts -m ping 指令，报错：</div></pre></td></tr></table></figure>
<p>njs_test5 | FAILED! =&gt; {<br>    “failed”: true,<br>    “msg”: “paramiko is not installed”<br>}<br>```</p>
<pre><code>* 本机没有安装 paramiko，或者安装有错，可以进行python命令行界面，执行import paramiko，查看paramiko是否安装正确
</code></pre><h3 id="疑问项？？？"><a href="#疑问项？？？" class="headerlink" title="疑问项？？？"></a>疑问项？？？</h3><ul>
<li>直接使用了svn的模块，ssh到njstest进行分支的使用，并没有配置用户名。njstest到svn服务器进行checkout的时候，svn对checkout用户的权限检验？？njstest系统中哪边有配置对应用户么？？？貌似svn自己有记录的？第一次update的时候。那如果没有权限的情况呢“？？？可以找一台不是我的用户的拿mtms试试</li>
<li>Neither the JAVA_HOME nor the JRE_HOME environment variable is defined；调用shell模块，并不是先通过ssh去登陆然后执行，而是通过ssh直接执行指令，所以 .bash_profile并没有加载。</li>
<li>每个task之间没有连续性，可以理解为每次都是单次的ssh，不会应为上一个cd后续的命令就在对应的目录下执行</li>
</ul>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ansible/" rel="tag"># ansible</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/18/进化-从孤胆极客到高效团队-note/" rel="next" title="进化-从孤胆极客到高效团队-note">
                <i class="fa fa-chevron-left"></i> 进化-从孤胆极客到高效团队-note
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/12/2017-年度计划/" rel="prev" title="2017_年度计划">
                2017_年度计划 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="lanourain" />
          <p class="site-author-name" itemprop="name">lanourain</p>
          <p class="site-description motion-element" itemprop="description">lanourain</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#ansible安装"><span class="nav-number">1.</span> <span class="nav-text">ansible安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务器信息配置"><span class="nav-number">2.</span> <span class="nav-text">服务器信息配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#指令相关"><span class="nav-number">3.</span> <span class="nav-text">指令相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#常用执行：ansible，-ansible-playbook（执行playbook）"><span class="nav-number">3.1.</span> <span class="nav-text">常用执行：ansible， ansible-playbook（执行playbook）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#playbook相关"><span class="nav-number">4.</span> <span class="nav-text">playbook相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#yaml解析"><span class="nav-number">4.1.</span> <span class="nav-text">yaml解析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#notify使用"><span class="nav-number">4.2.</span> <span class="nav-text">notify使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特性："><span class="nav-number">4.3.</span> <span class="nav-text">特性：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块相关"><span class="nav-number">5.</span> <span class="nav-text">模块相关</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量相关"><span class="nav-number">6.</span> <span class="nav-text">变量相关</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在文件中定义变量"><span class="nav-number">6.1.</span> <span class="nav-text">在文件中定义变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在playbook中定义变量"><span class="nav-number">6.2.</span> <span class="nav-text">在playbook中定义变量</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#In-older-versions-of-ansible-use-success-now-both-are-valid-but-succeeded-uses-the-correct-tense"><span class="nav-number"></span> <span class="nav-text">In older versions of ansible use |success, now both are valid but succeeded uses the correct tense.</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#template-example，a-config"><span class="nav-number"></span> <span class="nav-text">template example，a config</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#疑问项？？？"><span class="nav-number">1.</span> <span class="nav-text">疑问项？？？</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lanourain</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  
      <!-- UY BEGIN -->
      <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid="></script>
      <!-- UY END -->
  




  
  

  

  

  

  


</body>
</html>
